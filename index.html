<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²å­æ²Ÿé€šè¯æœ¯åŠ©æ‰‹ - DeepSeek AIç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="äº²å­æ²Ÿé€šè¯æœ¯åŠ©æ‰‹">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="äº²å­æ²Ÿé€šåŠ©æ‰‹">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#8e44ad">
    <link rel="manifest" href="/manifest.json">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
            height: 100vh;
            overflow: hidden;
        }
        
        .page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }
        
        #home-page {
            display: flex;
            flex-direction: column;
            background: #f0f4ff;
        }
        
        .app-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            flex-shrink: 0;
        }
        
        .app-title {
            font-size: 26px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .app-subtitle {
            font-size: 15px;
            opacity: 0.9;
        }
        
        .premium-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
        }
        
        .scenes-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .scenes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
            flex: 1;
            gap: 12px;
            padding: 15px;
            background: #f0f4ff;
            min-height: 0;
        }
        
        .scene-card {
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 18px 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border: 3px solid white;
            min-height: 90px;
        }
        
        .scene-card:hover {
            transform: translateY(-5px);
            filter: brightness(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .scene-icon {
            font-size: 32px;
            margin-right: 15px;
            flex-shrink: 0;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .scene-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .scene-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 5px;
            line-height: 1.2;
        }
        
        .scene-desc {
            font-size: 13px;
            opacity: 0.9;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            line-height: 1.3;
        }
        
        #homework { background: linear-gradient(135deg, #6a89cc, #4a69bd); }
        #emotion { background: linear-gradient(135deg, #f8c291, #e55039); }
        #discipline { background: linear-gradient(135deg, #82ccdd, #60a3bc); }
        #screen { background: linear-gradient(135deg, #b8e994, #78e08f); }
        #friend { background: linear-gradient(135deg, #fad390, #f6b93b); }
        #school { background: linear-gradient(135deg, #d980fa, #9980fa); }
        
        #chat-page {
            background: #f5f7fa;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
            flex-shrink: 0;
        }
        
        .back-btn {
            font-size: 20px;
            margin-right: 15px;
            cursor: pointer;
            color: #4a69bd;
        }
        
        .chat-scene-info {
            display: flex;
            align-items: center;
        }
        
        .scene-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .chat-scene-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            margin-bottom: 15px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            word-wrap: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .ai-message {
            align-self: flex-start;
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .input-area {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            flex-shrink: 0;
        }
        
        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 24px;
            outline: none;
            font-size: 16px;
        }
        
        .send-btn {
            background: #4a69bd;
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s;
        }
        
        .send-btn:hover {
            background: #3c5aa8;
        }
        
        .send-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .typing-indicator {
          align-self: flex-start;
          background: white;
          color: #666;
          padding: 12px 16px;
          border-radius: 18px;
          border-bottom-left-radius: 4px;
          display: none;
          border: 1px solid #e0e0e0;
          font-style: italic;
        }

        .typing-dots {
          display: inline-flex;
          align-items: center;
          gap: 2px;
        }

        .typing-dots span {
          animation: typing 1.4s infinite;
          display: inline-block;
          font-size: 18px;
        }

        .typing-dots span:nth-child(2) {
          animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
          animation-delay: 0.4s;
        }

        @keyframes typing {
          0%, 60%, 100% { 
            transform: translateY(0);
            opacity: 0.4;
          }
          30% { 
            transform: translateY(-5px);
            opacity: 1;
          }
        }

        .message {
          animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
          from { 
            opacity: 0; 
            transform: translateY(10px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        
        .api-status {
            text-align: center;
            padding: 5px;
            font-size: 12px;
            color: #666;
            background: #f0f4ff;
            flex-shrink: 0;
        }
        
        .error-message {
            align-self: flex-start;
            background: #ffe6e6;
            color: #d63031;
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            border: 1px solid #ffcccc;
            max-width: 85%;
            margin-bottom: 15px;
        }
        
        #paywallModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .paywall-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .agreement-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .agreement-content h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .agreement-content h4 {
            color: #4a69bd;
            margin: 20px 0 10px 0;
        }
        
        .agreement-content p {
            margin-bottom: 15px;
            color: #666;
        }
        
        .agreement-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .agreement-content li {
            margin-bottom: 8px;
            color: #666;
        }
        
        .payment-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        
        .payment-method {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-method:hover {
            border-color: #4a69bd;
            background: #f8f9ff;
        }
        
        .payment-method.selected {
            border-color: #4a69bd;
            background: #f0f4ff;
        }
        
        .payment-method span {
            font-weight: 500;
        }
        
        .price-options {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .price-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .price-option.selected {
            border-color: #4a69bd;
            background: #f0f4ff;
        }
        
        .price-option .price {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .price-option .period {
            font-size: 12px;
            color: #666;
        }
        
        .agreement-checkbox {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
            text-align: left;
        }
        
        .agreement-checkbox input {
            margin-right: 10px;
            margin-top: 3px;
        }
        
        .agreement-checkbox label {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .agreement-link {
            color: #4a69bd;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .pay-button {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .pay-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .pay-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .benefits-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .benefit-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .benefit-icon {
            font-size: 24px;
            margin-right: 15px;
            color: #4a69bd;
        }
        
        .benefit-text h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .benefit-text p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .footer-links {
            background: white;
            padding: 12px 0;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            flex-shrink: 0;
        }
        
        .footer-links a {
            color: #666;
            text-decoration: none;
            margin: 0 15px;
            font-size: 12px;
        }
        
        .footer-links a:hover {
            color: #4a69bd;
        }
        
        .usage-limit-message {
            background: #fff3cd;
            color: #856404;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 20px;
            text-align: center;
            border: 1px solid #ffeaa7;
        }
        
        @media (max-width: 600px) {
            .app-title {
                font-size: 22px;
            }
            
            .app-subtitle {
                font-size: 13px;
            }
            
            .premium-btn {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px auto 0;
                display: block;
                width: fit-content;
            }
            
            .scenes-grid {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(6, 1fr);
                gap: 10px;
                padding: 12px;
            }
            
            .scene-card {
                padding: 16px 12px;
                min-height: 85px;
            }
            
            .scene-icon {
                font-size: 28px;
                margin-right: 12px;
            }
            
            .scene-title {
                font-size: 17px;
            }
            
            .scene-desc {
                font-size: 12px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .footer-links {
                padding: 10px 0;
            }
            
            .footer-links a {
                margin: 0 10px;
                font-size: 11px;
            }
        }

        @media (max-width: 400px) {
            .scene-card {
                padding: 14px 10px;
                min-height: 80px;
            }
            
            .scene-icon {
                font-size: 26px;
                margin-right: 10px;
            }
            
            .scene-title {
                font-size: 16px;
            }
            
            .footer-links a {
                margin: 0 8px;
                font-size: 10px;
            }
        }

        @media (max-height: 700px) {
            .scene-card {
                padding: 12px 10px;
                min-height: 75px;
            }
            
            .scene-icon {
                font-size: 24px;
            }
            
            .scene-title {
                font-size: 16px;
            }
            
            .scene-desc {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- é¦–é¡µ -->
    <div id="home-page" class="page">
        <div class="app-header">
            <button class="premium-btn" onclick="openPremiumModal()">
                <i class="fas fa-crown"></i> ä¼šå‘˜ç‰ˆ
            </button>
            <div class="app-title">äº²å­æ²Ÿé€šè¯æœ¯åŠ©æ‰‹</div>
            <div class="app-subtitle">AIäº²å­æ²Ÿé€šæ•™ç»ƒ Â· 6å¤§åœºæ™¯ä¸“ä¸šè¯æœ¯ Â· ç«‹å³æ”¹å–„äº²å­å…³ç³»</div>
        </div>
        
        <div class="scenes-container">
            <div class="scenes-grid">
                <div class="scene-card" id="homework" data-scene="homework">
                    <div class="scene-icon">ğŸ“š</div>
                    <div class="scene-content">
                        <div class="scene-title">ä½œä¸šè¾…å¯¼</div>
                        <div class="scene-desc">è§£å†³å­¦ä¹ éš¾é¢˜ï¼ŒåŸ¹å…»å­¦ä¹ ä¹ æƒ¯</div>
                    </div>
                </div>
                <div class="scene-card" id="emotion" data-scene="emotion">
                    <div class="scene-icon">ğŸ˜¢</div>
                    <div class="scene-content">
                        <div class="scene-title">æƒ…ç»ªç®¡ç†</div>
                        <div class="scene-desc">ç†è§£å­©å­æƒ…ç»ªï¼Œå»ºç«‹æƒ…æ„Ÿè¿æ¥</div>
                    </div>
                </div>
                <div class="scene-card" id="discipline" data-scene="discipline">
                    <div class="scene-icon">âš–ï¸</div>
                    <div class="scene-content">
                        <div class="scene-title">è¡Œä¸ºè§„èŒƒ</div>
                        <div class="scene-desc">è®¾å®šåˆç†ç•Œé™ï¼ŒåŸ¹å…»è‰¯å¥½ä¹ æƒ¯</div>
                    </div>
                </div>
                <div class="scene-card" id="screen" data-scene="screen">
                    <div class="scene-icon">ğŸ“±</div>
                    <div class="scene-content">
                        <div class="scene-title">å±å¹•æ—¶é—´</div>
                        <div class="scene-desc">ç®¡ç†ç”µå­è®¾å¤‡ï¼Œå¹³è¡¡æ•°å­—ç”Ÿæ´»</div>
                    </div>
                </div>
                <div class="scene-card" id="friend" data-scene="friend">
                    <div class="scene-icon">ğŸ‘«</div>
                    <div class="scene-content">
                        <div class="scene-title">æœ‹å‹å…³ç³»</div>
                        <div class="scene-desc">å¤„ç†åŒä¼´å…³ç³»ï¼ŒåŸ¹å…»ç¤¾äº¤èƒ½åŠ›</div>
                    </div>
                </div>
                <div class="scene-card" id="school" data-scene="school">
                    <div class="scene-icon">ğŸ«</div>
                    <div class="scene-content">
                        <div class="scene-title">å­¦æ ¡ç”Ÿæ´»</div>
                        <div class="scene-desc">åº”å¯¹å­¦ä¸šå‹åŠ›ï¼Œå¤„ç†å­¦æ ¡äº‹åŠ¡</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-links">
            <a href="javascript:void(0)" onclick="showUserAgreement()">ç”¨æˆ·åè®®</a>
            <a href="javascript:void(0)" onclick="showPrivacyPolicy()">éšç§æ”¿ç­–</a>
            <a href="javascript:void(0)" onclick="showBenefitsPage()">ä¼šå‘˜æƒç›Š</a>
            <a href="mailto:service@parenting-assistant.com">è”ç³»æˆ‘ä»¬</a>
        </div>
    </div>
    
    <!-- èŠå¤©é¡µé¢ -->
    <div id="chat-page" class="page">
        <div class="chat-header">
            <div class="back-btn" id="back-btn">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="chat-scene-info">
                <div class="scene-color" id="scene-color"></div>
                <div class="chat-scene-title" id="chat-scene-title">ä½œä¸šè¾…å¯¼</div>
            </div>
        </div>
        
        <div class="chat-container" id="chat-container">
            <div class="message ai-message">
                <strong>ğŸ‘‹ æ¬¢è¿ä½¿ç”¨äº²å­æ²Ÿé€šåŠ©æ‰‹ï¼</strong><br><br>
                æˆ‘æ˜¯æ‚¨çš„AIæ²Ÿé€šæ•™ç»ƒï¼Œæ‹¥æœ‰20å¹´å„¿ç«¥æ•™è‚²ç»éªŒã€‚<br>
                ğŸ’¡ <strong>æˆ‘èƒ½ä¸ºæ‚¨ï¼š</strong><br>
                â€¢ æä¾›å…·ä½“å¯æ“ä½œçš„æ²Ÿé€šè¯æœ¯<br>
                â€¢ åˆ†æå­©å­è¡Œä¸ºèƒŒåçš„åŸå› <br>
                â€¢ å»ºè®®æœ‰æ•ˆçš„æ²Ÿé€šç­–ç•¥<br><br>
                è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„äº²å­æ²Ÿé€šé—®é¢˜ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›ä¸“ä¸šå»ºè®®ã€‚
            </div>
        </div>
        
        <div class="typing-indicator" id="typing-indicator">
            <span>AIæ­£åœ¨æ€è€ƒ</span><div class="typing-dots"><span>.</span><span>.</span><span>.</span></div>
        </div>
        
        <div class="api-status" id="api-status">
            <span id="status-text">æ­£åœ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€...</span>
            <span id="usage-count" style="margin-left: 10px; display: none;">
                | ä»Šæ—¥å‰©ä½™: <span id="free-usage">3</span> æ¬¡æé—®
            </span>
            <span id="member-status" style="margin-left: 10px; display: none;">
                | <i class="fas fa-crown" style="color: #f39c12;"></i> ä¼šå‘˜ç‰ˆ
            </span>
        </div>
        
        <div class="input-area">
            <input type="text" class="message-input" id="message-input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜...">
            <button class="send-btn" id="send-btn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <!-- ä¼šå‘˜å¼¹çª— -->
    <div id="paywallModal">
        <div class="paywall-content">
            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ‘‘</div>
            <h3 style="margin-bottom: 10px; color: #333;">å‡çº§ä¼šå‘˜è§£é”å®Œæ•´åŠŸèƒ½</h3>
            <p style="color: #666; margin-bottom: 25px;">å‡çº§ä¼šå‘˜ç‰ˆï¼Œäº«å—å®Œæ•´æœåŠ¡</p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <div style="display: flex; justify-content: center; align-items: baseline; margin-bottom: 15px;">
                    <span style="font-size: 32px; font-weight: bold; color: #e74c3c;">Â¥29.9</span>
                    <span style="color: #666; margin-left: 5px;">/æœˆ</span>
                </div>
                
                <div style="text-align: left;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span style="color: #27ae60; margin-right: 8px;">âœ“</span>
                        <span>æ— é™æ¬¡AIå¯¹è¯å’¨è¯¢</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span style="color: #27ae60; margin-right: 8px;">âœ“</span>
                        <span>å…¨åœºæ™¯è¯æœ¯æŒ‡å¯¼</span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span style="color: #27ae60; margin-right: 8px;">âœ“</span>
                        <span>ä¸ªæ€§åŒ–æ²Ÿé€šæ–¹æ¡ˆ</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <span style="color: #27ae60; margin-right: 8px;">âœ“</span>
                        <span>ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ</span>
                    </div>
                </div>
            </div>
            
            <button onclick="showPaymentPage()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-bottom: 15px;">
                ç«‹å³å‡çº§ä¼šå‘˜
            </button>
            <button onclick="showBenefitsPage()" style="background: transparent; color: #666; border: 1px solid #ddd; padding: 12px 30px; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 10px;">
                æŸ¥çœ‹ä¼šå‘˜æƒç›Š
            </button>
            <button onclick="closePaywall()" style="background: transparent; color: #999; border: none; padding: 10px 30px; border-radius: 8px; cursor: pointer; width: 100%;">
                ç»§ç»­ä½¿ç”¨å…è´¹ç‰ˆ
            </button>
        </div>
    </div>
    
    <!-- ä¼šå‘˜æƒç›Šé¡µé¢ -->
    <div id="benefitsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;">
        <div class="benefits-content">
            <h3 style="margin-bottom: 20px; color: #333; text-align: center;">ä¼šå‘˜ä¸“å±æƒç›Š</h3>
            
            <div class="benefit-item">
                <div class="benefit-icon">ğŸ’¬</div>
                <div class="benefit-text">
                    <h4>æ— é™AIå¯¹è¯</h4>
                    <p>ä¸å—æ¬¡æ•°é™åˆ¶ï¼Œéšæ—¶å’¨è¯¢äº²å­æ²Ÿé€šé—®é¢˜ï¼Œè·å¾—ä¸“ä¸šå»ºè®®</p>
                </div>
            </div>
            
            <div class="benefit-item">
                <div class="benefit-icon">ğŸ¯</div>
                <div class="benefit-text">
                    <h4>ä¸ªæ€§åŒ–æ–¹æ¡ˆ</h4>
                    <p>æ ¹æ®æ‚¨å­©å­çš„å¹´é¾„ã€æ€§æ ¼ç‰¹ç‚¹ï¼Œå®šåˆ¶ä¸“å±æ²Ÿé€šç­–ç•¥</p>
                </div>
            </div>
            
            <div class="benefit-item">
                <div class="benefit-icon">ğŸ“š</div>
                <div class="benefit-text">
                    <h4>å…¨åœºæ™¯è¦†ç›–</h4>
                    <p>æ¶µç›–ä½œä¸šã€æƒ…ç»ªã€è¡Œä¸ºã€å±å¹•æ—¶é—´ç­‰æ‰€æœ‰äº²å­æ²Ÿé€šåœºæ™¯</p>
                </div>
            </div>
            
            <div class="benefit-item">
                <div class="benefit-icon">ğŸš€</div>
                <div class="benefit-text">
                    <h4>ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ</h4>
                    <p>ä¸“å±å®¢æœé€šé“ï¼Œå¿«é€Ÿè§£å†³ä½¿ç”¨é—®é¢˜</p>
                </div>
            </div>
            
            <div class="benefit-item">
                <div class="benefit-icon">ğŸ†•</div>
                <div class="benefit-text">
                    <h4>æŒç»­æ›´æ–°</h4>
                    <p>å®šæœŸæ›´æ–°è¯æœ¯åº“ï¼Œç´§è·Ÿæ•™è‚²ç†å¿µå‘å±•</p>
                </div>
            </div>
            
            <button onclick="showPaymentPage()" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px;">
                ç«‹å³å¼€é€šä¼šå‘˜
            </button>
            <button onclick="closeBenefits()" style="background: transparent; color: #666; border: 1px solid #ddd; padding: 12px 30px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px;">
                è¿”å›
            </button>
        </div>
    </div>
    
    <!-- æ”¯ä»˜é¡µé¢ -->
    <div id="paymentModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;">
        <div class="payment-content">
            <h3 style="margin-bottom: 10px; color: #333;">å¼€é€šä¼šå‘˜</h3>
            <p style="color: #666; margin-bottom: 20px;">é€‰æ‹©æ”¯ä»˜æ–¹å¼å®Œæˆå¼€é€š</p>
            
            <div class="price-options">
                <div class="price-option selected" onclick="selectPriceOption(this, 29.9, 'month')">
                    <div class="price">Â¥29.9</div>
                    <div class="period">æœˆåº¦ä¼šå‘˜</div>
                </div>
                <div class="price-option" onclick="selectPriceOption(this, 299, 'year')">
                    <div class="price">Â¥299</div>
                    <div class="period">å¹´åº¦ä¼šå‘˜</div>
                    <div style="font-size: 12px; color: #27ae60;">çœÂ¥59.8</div>
                </div>
            </div>
            
            <div class="payment-methods">
                <div class="payment-method selected" onclick="selectPaymentMethod(this, 'wechat')">
                    <div style="width: 30px; height: 30px; background: #07c160; border-radius: 5px; margin-right: 15px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">å¾®</div>
                    <span>å¾®ä¿¡æ”¯ä»˜</span>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod(this, 'alipay')">
                    <div style="width: 30px; height: 30px; background: #1677ff; border-radius: 5px; margin-right: 15px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">æ”¯</div>
                    <span>æ”¯ä»˜å®</span>
                </div>
            </div>
            
            <div class="agreement-checkbox">
                <input type="checkbox" id="agreeCheckbox">
                <label for="agreeCheckbox">
                    æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <span class="agreement-link" onclick="showUserAgreement()">ã€Šç”¨æˆ·åè®®ã€‹</span> å’Œ 
                    <span class="agreement-link" onclick="showPrivacyPolicy()">ã€Šéšç§æ”¿ç­–ã€‹</span>
                </label>
            </div>
            
            <button class="pay-button" id="payButton" onclick="processPayment()" disabled>
                ç«‹å³æ”¯ä»˜ Â¥29.9
            </button>
            
            <button onclick="closePayment()" style="background: transparent; color: #666; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px;">
                è¿”å›
            </button>
        </div>
    </div>
    
    <!-- ç”¨æˆ·åè®®å¼¹çª— -->
    <div id="agreementModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;">
        <div class="agreement-content">
            <h3>ç”¨æˆ·åè®®</h3>
            
            <h4>1. æœåŠ¡è¯´æ˜</h4>
            <p>äº²å­æ²Ÿé€šè¯æœ¯åŠ©æ‰‹æ˜¯ä¸€æ¬¾åŸºäºAIæŠ€æœ¯çš„äº²å­æ²Ÿé€šæŒ‡å¯¼å·¥å…·ï¼Œä¸ºç”¨æˆ·æä¾›äº²å­æ²Ÿé€šè¯æœ¯å»ºè®®å’ŒæŒ‡å¯¼ã€‚</p>
            
            <h4>2. ä¼šå‘˜æœåŠ¡</h4>
            <p>ä¼šå‘˜æœåŠ¡åŒ…æ‹¬ï¼š</p>
            <ul>
                <li>æ— é™æ¬¡AIå¯¹è¯å’¨è¯¢</li>
                <li>å…¨åœºæ™¯è¯æœ¯æŒ‡å¯¼</li>
                <li>ä¸ªæ€§åŒ–æ²Ÿé€šæ–¹æ¡ˆ</li>
                <li>ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ</li>
            </ul>
            
            <h4>3. è´¹ç”¨è¯´æ˜</h4>
            <p>ä¼šå‘˜æœåŠ¡ä¸ºä»˜è´¹è®¢é˜…åˆ¶ï¼Œè´¹ç”¨åœ¨è´­ä¹°æ—¶ä¸€æ¬¡æ€§æ”¶å–ã€‚è‡ªåŠ¨ç»­è´¹æœåŠ¡å¯åœ¨è®¢é˜…æœŸå†…éšæ—¶å–æ¶ˆã€‚</p>
            
            <h4>4. é€€æ¬¾æ”¿ç­–</h4>
            <p>ç”±äºæœ¬äº§å“ä¸ºæ•°å­—å†…å®¹æœåŠ¡ï¼Œä¸€ç»è´­ä¹°å³å¼€å§‹æä¾›æœåŠ¡ï¼Œå› æ­¤ä¸æ”¯æŒé€€æ¬¾ã€‚è¯·åœ¨è´­ä¹°å‰å……åˆ†ä½“éªŒå…è´¹åŠŸèƒ½ã€‚</p>
            
            <h4>5. ä½¿ç”¨è§„èŒƒ</h4>
            <p>ç”¨æˆ·ä¸å¾—åˆ©ç”¨æœ¬æœåŠ¡ä»äº‹ä»»ä½•è¿æ³•æ´»åŠ¨ï¼Œä¸å¾—æ¶æ„æ”»å‡»ç³»ç»Ÿã€‚</p>
            
            <button onclick="closeAgreement()" style="background: #4a69bd; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 20px;">
                åŒæ„å¹¶å…³é—­
            </button>
        </div>
    </div>
    
    <!-- éšç§æ”¿ç­–å¼¹çª— -->
    <div id="privacyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center;">
        <div class="agreement-content">
            <h3>éšç§æ”¿ç­–</h3>
            
            <h4>1. ä¿¡æ¯æ”¶é›†</h4>
            <p>æˆ‘ä»¬ä»…æ”¶é›†å¿…è¦çš„æœåŠ¡ä½¿ç”¨æ•°æ®ï¼ŒåŒ…æ‹¬å¯¹è¯å†…å®¹ã€ä½¿ç”¨é¢‘ç‡ç­‰ï¼Œç”¨äºæ”¹å–„æœåŠ¡è´¨é‡ã€‚</p>
            
            <h4>2. ä¿¡æ¯ä½¿ç”¨</h4>
            <p>æ”¶é›†çš„ä¿¡æ¯ä»…ç”¨äºï¼š</p>
            <ul>
                <li>æä¾›å’Œæ”¹è¿›AIå¯¹è¯æœåŠ¡</li>
                <li>ä¸ªæ€§åŒ–æ¨èç›¸å…³å†…å®¹</li>
                <li>ç¡®ä¿æœåŠ¡å®‰å…¨ç¨³å®šè¿è¡Œ</li>
            </ul>
            
            <h4>3. æ•°æ®å®‰å…¨</h4>
            <p>æˆ‘ä»¬é‡‡å–ä¸¥æ ¼çš„å®‰å…¨æªæ–½ä¿æŠ¤ç”¨æˆ·æ•°æ®ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€ä½¿ç”¨æˆ–æ³„éœ²ã€‚</p>
            
            <h4>4. æ•°æ®ä¿ç•™</h4>
            <p>ç”¨æˆ·æ•°æ®ä»…åœ¨æä¾›æœåŠ¡æœŸé—´ä¿ç•™ï¼Œç”¨æˆ·å¯éšæ—¶è¦æ±‚åˆ é™¤ä¸ªäººæ•°æ®ã€‚</p>
            
            <h4>5. è”ç³»æˆ‘ä»¬</h4>
            <p>å¦‚å¯¹éšç§æ”¿ç­–æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·è”ç³»ï¼šservice@parenting-assistant.com</p>
            
            <button onclick="closePrivacy()" style="background: #4a69bd; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 20px;">
                åŒæ„å¹¶å…³é—­
            </button>
        </div>
    </div>

    <script>
        // ========== é”™è¯¯å±è”½å’Œå…¨å±€å¤„ç† ==========
        // å±è”½ç¬¬ä¸‰æ–¹è„šæœ¬é”™è¯¯
        window.addEventListener('error', function(e) {
            const ignoreErrors = [
                '__jstcache',
                'sessionStorage',
                'jinritemai.com',
                'bytegoofy.com',
                'douchacha.com'
            ];
            
            const errorStr = (e.message + ' ' + (e.filename || '')).toLowerCase();
            if (ignoreErrors.some(keyword => errorStr.includes(keyword.toLowerCase()))) {
                e.preventDefault();
                console.log('å·²å±è”½ç¬¬ä¸‰æ–¹é”™è¯¯:', e.message);
                return true;
            }
        });

        // å±è”½æœªå¤„ç†çš„Promiseæ‹’ç»
        window.addEventListener('unhandledrejection', function(e) {
            const ignoreRejections = [
                'sessionStorage'
            ];
            
            if (e.reason && ignoreRejections.some(keyword => 
                e.reason.toString().toLowerCase().includes(keyword.toLowerCase()))) {
                e.preventDefault();
                console.log('å·²å±è”½Promiseæ‹’ç»:', e.reason);
                return true;
            }
        });

        // ========== æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ==========
        const expandedScriptLibrary = {
            homework: { title: "ä½œä¸šè¾…å¯¼", color: "#4a69bd", prompts: ["æˆ‘æ³¨æ„åˆ°ä½ ä»Šå¤©çš„ä½œä¸šæœ‰ç‚¹å¤šï¼Œéœ€è¦æˆ‘å¸®ä½ è§„åˆ’ä¸€ä¸‹æ—¶é—´å—ï¼Ÿ", "è¿™é“é¢˜çœ‹èµ·æ¥æœ‰ç‚¹éš¾ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹é¢˜ç›®è¦æ±‚æ˜¯ä»€ä¹ˆå¥½å—ï¼Ÿ", "ä½ å·²ç»ä¸“æ³¨å­¦ä¹ 20åˆ†é’Ÿäº†ï¼Œè¦ä¸è¦ä¼‘æ¯5åˆ†é’Ÿå†ç»§ç»­ï¼Ÿ", "æˆ‘çœ‹åˆ°ä½ åœ¨è¿™é“é¢˜ä¸ŠèŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œè¦ä¸è¦æ¢ä¸ªæ€è·¯è¯•è¯•ï¼Ÿ", "ä½œä¸šç¡®å®æœ‰æ—¶å€™ä¼šè®©äººæ„Ÿåˆ°çƒ¦èºï¼Œæˆ‘ä»¬å…ˆå®Œæˆä¸€éƒ¨åˆ†ç„¶åä¼‘æ¯ä¸€ä¸‹æ€ä¹ˆæ ·ï¼Ÿ", "æˆ‘è®°å¾—ä½ ä¸Šæ¬¡æ•°å­¦é¢˜åšå¾—å¾ˆå¥½ï¼Œè¿™æ¬¡ä¹Ÿå¯ä»¥è¯•è¯•é‚£ç§æ–¹æ³•", "å¦‚æœè§‰å¾—å¤ªéš¾ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ†è§£æˆå‡ ä¸ªå°æ­¥éª¤æ¥å®Œæˆ", "ä½ å¸Œæœ›æˆ‘å…ˆå¸®ä½ æ£€æŸ¥å·²ç»å®Œæˆçš„éƒ¨åˆ†ï¼Œè¿˜æ˜¯ç»§ç»­å¾€ä¸‹åšï¼Ÿ", "å­¦ä¹ æ–°çŸ¥è¯†ç¡®å®éœ€è¦æ—¶é—´ï¼Œä¸ç”¨ç€æ€¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥", "è¿™ä¸ªçŸ¥è¯†ç‚¹ç¡®å®æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸€äº›ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£"], tips: "ä½œä¸šè¾…å¯¼æ—¶ï¼Œé¿å…ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œå¤šä½¿ç”¨å¼•å¯¼æ€§é—®é¢˜ã€‚å…³æ³¨å­©å­çš„åŠªåŠ›è¿‡ç¨‹è€Œéç»“æœï¼Œå¸®åŠ©å»ºç«‹å­¦ä¹ è‡ªä¿¡å¿ƒã€‚" },
            emotion: { title: "æƒ…ç»ªç®¡ç†", color: "#e55039", prompts: ["ä½ çœ‹èµ·æ¥æœ‰ç‚¹éš¾è¿‡ï¼Œæ„¿æ„å’Œå¦ˆå¦ˆ/çˆ¸çˆ¸è¯´è¯´å‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ", "ç”Ÿæ°”æ˜¯æ­£å¸¸çš„æƒ…ç»ªï¼Œä½†æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ›´å¥½çš„æ–¹å¼è¡¨è¾¾å®ƒã€‚", "æˆ‘ç†è§£ä½ ç°åœ¨å¾ˆå¤±æœ›ï¼Œæ¢ä½œæ˜¯æˆ‘å¯èƒ½ä¹Ÿä¼šè¿™æ ·æ„Ÿè§‰ã€‚", "å½“ä½ æ„Ÿåˆ°ç„¦è™‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·åšå‡ ä¸ªæ·±å‘¼å¸æ¥å¹³é™ä¸‹æ¥ã€‚", "è¿™ç§æ„Ÿå—ä¸€å®šå¾ˆéš¾å—ï¼Œæˆ‘åœ¨è¿™é‡Œé™ªç€ä½ ", "æ¯ä¸ªäººéƒ½ä¼šæœ‰æƒ…ç»ªæ³¢åŠ¨çš„æ—¶å€™ï¼Œè¿™å¾ˆæ­£å¸¸", "å¦‚æœä½ ä¸æƒ³ç°åœ¨è¯´ï¼Œç­‰ä½ æƒ³è¯´çš„æ—¶å€™æˆ‘éšæ—¶åœ¨è¿™é‡Œ", "æˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªå®‰é™çš„åœ°æ–¹ï¼Œç­‰ä½ æ„Ÿè§‰å¥½ä¸€ç‚¹å†èŠ", "æƒ…ç»ªå°±åƒå¤©æ°”ï¼Œæœ‰æ—¶æ™´æœ—æœ‰æ—¶é˜´é›¨ï¼Œä½†éƒ½ä¼šè¿‡å»çš„", "æˆ‘æ³¨æ„åˆ°ä½ çš„å‘¼å¸æœ‰ç‚¹æ€¥ä¿ƒï¼Œæˆ‘ä»¬æ…¢æ…¢æ·±å‘¼å¸å‡ æ¬¡å¥½å—ï¼Ÿ"], tips: "è®¤å¯å­©å­çš„æƒ…ç»ªï¼Œå¸®åŠ©ä»–ä»¬ç»™æƒ…ç»ªå‘½åã€‚ä¸è¦å¦å®šæˆ–å¿½è§†å­©å­çš„æ„Ÿå—ï¼Œæ•™ä»–ä»¬å¥åº·åœ°è¡¨è¾¾æƒ…ç»ªã€‚" },
            discipline: { title: "è¡Œä¸ºè§„èŒƒ", color: "#60a3bc", prompts: ["æˆ‘çŸ¥é“ä½ æƒ³ç»§ç»­ç©ï¼Œä½†ç°åœ¨æ˜¯åƒé¥­æ—¶é—´äº†ï¼Œæˆ‘ä»¬çº¦å®šå¥½çš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ", "åœ¨å®¢å…é‡Œè·‘åŠ¨å¯èƒ½ä¼šæ’åˆ°ä¸œè¥¿å—ä¼¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ·å¤–å°½æƒ…å¥”è·‘ã€‚", "æˆ‘ç†è§£ä½ å¾ˆç”Ÿæ°”ï¼Œä½†æ‰“äººä¸æ˜¯è§£å†³é—®é¢˜çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¯­è¨€è¡¨è¾¾æ„Ÿå—ã€‚", "ç©å…·ç©å®Œåè¦æ”¾å›åŸå¤„ï¼Œè¿™æ ·ä¸‹æ¬¡æ‰¾èµ·æ¥æ›´æ–¹ä¾¿ï¼Œéœ€è¦æˆ‘å¸®ä½ ä¸€èµ·æ•´ç†å—ï¼Ÿ", "æˆ‘ä»¬å®¶çš„è§„åˆ™æ˜¯æ™šä¸Š9ç‚¹å‰è¦å®Œæˆä½œä¸šï¼Œç°åœ¨7ç‚¹åŠï¼Œä½ è®¡åˆ’æ€ä¹ˆå®‰æ’ï¼Ÿ", "å¤§å£°è¯´è¯ä¼šæ‰“æ‰°åˆ°åˆ«äººï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•ç”¨æ­£å¸¸çš„éŸ³é‡äº¤æµ", "æˆ‘ç†è§£ä½ æƒ³åƒç³–ï¼Œä½†ç³–åƒå¤šäº†å¯¹ç‰™é½¿ä¸å¥½ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ°´æœä½œä¸ºé›¶é£Ÿ", "çœ‹åˆ°åˆ«äººç©å¾—å¼€å¿ƒï¼Œç›´æ¥æ‹¿èµ°ç©å…·æ˜¯ä¸ç¤¼è²Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥é—®é—®æ˜¯å¦å¯ä»¥ä¸€èµ·ç©", "å…¬å…±åœºæ‰€æˆ‘ä»¬éœ€è¦è€ƒè™‘å…¶ä»–äººçš„æ„Ÿå—ï¼Œè¯´è¯éŸ³é‡å¯ä»¥ç¨å¾®ä½ä¸€äº›", "æˆ‘çŸ¥é“ä½ å¾ˆæƒ³ç°åœ¨å°±ä¹°è¿™ä¸ªç©å…·ï¼Œä½†æˆ‘ä»¬ä¹‹å‰çº¦å®šå¥½ä¸€ä¸ªæœˆåªä¹°ä¸€æ¬¡ç©å…·"], tips: "è®¾å®šæ¸…æ™°ä¸€è‡´çš„è§„åˆ™ï¼Œè§£é‡Šè§„åˆ™èƒŒåçš„åŸå› ã€‚ä½¿ç”¨ç§¯æçš„è¯­è¨€å¼•å¯¼ï¼Œè€Œéç®€å•ç¦æ­¢ã€‚" },
            screen: { title: "å±å¹•æ—¶é—´", color: "#78e08f", prompts: ["è¿™ä¸ªæ¸¸æˆçœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼Œä½†æˆ‘ä»¬çº¦å®šçš„å±å¹•æ—¶é—´å¿«åˆ°äº†ï¼Œä½ å¸Œæœ›è‡ªå·±å…³è¿˜æ˜¯æˆ‘æé†’ä½ ï¼Ÿ", "é•¿æ—¶é—´çœ‹å±å¹•å¯¹çœ¼ç›ä¸å¥½ï¼Œæˆ‘ä»¬ä¼‘æ¯ä¸€ä¸‹åšç‚¹å…¶ä»–æœ‰è¶£çš„äº‹æƒ…å§ã€‚", "æˆ‘æ³¨æ„åˆ°ä½ æœ€è¿‘èŠ±å¾ˆå¤šæ—¶é—´åœ¨å¹³æ¿ä¸Šï¼Œæ˜¯æœ‰ä»€ä¹ˆç‰¹åˆ«å¸å¼•ä½ çš„å†…å®¹å—ï¼Ÿ", "æˆ‘ä»¬å¯ä»¥ä¸€èµ·åˆ¶å®šä¸€ä¸ªåˆç†çš„å±å¹•æ—¶é—´è®¡åˆ’ï¼Œå¹³è¡¡å­¦ä¹ å’Œå¨±ä¹ã€‚", "çœ‹å±å¹•æ—¶é—´åˆ°äº†ï¼Œä½ æ˜¯æƒ³ç°åœ¨å…³æ‰ï¼Œè¿˜æ˜¯å†ç©5åˆ†é’Ÿç„¶åå…³ï¼Ÿ", "æˆ‘ä»¬å¯ä»¥æŠŠå±å¹•æ—¶é—´å½“ä½œå®Œæˆä½œä¸šåçš„å¥–åŠ±ï¼Œä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ", "æˆ‘æ‹…å¿ƒé•¿æ—¶é—´çœ‹å±å¹•ä¼šå½±å“ä½ çš„è§†åŠ›ï¼Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªè®¡æ—¶å™¨å¥½å—ï¼Ÿ", "é™¤äº†ç”µå­äº§å“ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸€èµ·ç©æ¡Œæ¸¸æˆ–è€…æˆ·å¤–æ´»åŠ¨ï¼Œä½ æƒ³è¯•è¯•å—ï¼Ÿ", "è¿™ä¸ªæ¸¸æˆ/è§†é¢‘çœ‹èµ·æ¥å¾ˆæœ‰æ„æ€ï¼Œèƒ½å’Œæˆ‘åˆ†äº«ä¸€ä¸‹å®ƒå“ªé‡Œå¸å¼•ä½ å—ï¼Ÿ", "ç”µå­äº§å“æ˜¯æˆ‘ä»¬ç”Ÿæ´»çš„å·¥å…·ï¼Œè€Œä¸æ˜¯ç”Ÿæ´»çš„å…¨éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¼šæ§åˆ¶ä½¿ç”¨æ—¶é—´"], tips: "æå‰çº¦å®šå±å¹•æ—¶é—´è§„åˆ™ï¼Œä½¿ç”¨è®¡æ—¶å™¨å¸®åŠ©å­©å­å»ºç«‹æ—¶é—´è§‚å¿µã€‚æä¾›æœ‰è¶£çš„æ›¿ä»£æ´»åŠ¨ï¼Œå‡å°‘å¯¹ç”µå­è®¾å¤‡çš„ä¾èµ–ã€‚" },
            friend: { title: "æœ‹å‹å…³ç³»", color: "#f6b93b", prompts: ["æˆ‘ç†è§£ä½ å’Œæœ‹å‹ä¹‹é—´æœ‰äº›ä¸æ„‰å¿«ï¼Œæ„¿æ„å’Œæˆ‘è¯´è¯´å‘ç”Ÿäº†ä»€ä¹ˆå—ï¼Ÿ", "æœ‹å‹ä¹‹é—´æœ‰æ—¶ä¼šæœ‰ä¸åŒæ„è§ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œé‡è¦çš„æ˜¯å¦‚ä½•æ²Ÿé€šè§£å†³ã€‚", "å¦‚æœä½ å’Œæœ‹å‹æœ‰çŸ›ç›¾ï¼Œè¯•ç€ä»å¯¹æ–¹çš„è§’åº¦æƒ³ä¸€æƒ³ï¼Œä¹Ÿè®¸ä¼šæœ‰ä¸åŒçš„ç†è§£ã€‚", "çœŸæ­£çš„æœ‹å‹ä¼šå°Šé‡ä½ çš„æ„Ÿå—ï¼Œå¦‚æœå¯¹æ–¹æ€»æ˜¯è®©ä½ ä¸å¼€å¿ƒï¼Œå¯ä»¥è€ƒè™‘ä¿æŒä¸€ç‚¹è·ç¦»ã€‚", "äº¤æ–°æœ‹å‹æœ‰æ—¶å€™éœ€è¦å‹‡æ°”ï¼Œä½ å¯ä»¥å…ˆä»å…±åŒå…´è¶£å¼€å§‹èŠèµ·", "æœ‹å‹ä¹‹é—´äº’ç›¸å¸®åŠ©å¾ˆé‡è¦ï¼Œä½†ä¹Ÿè¦å­¦ä¼šè¯´'ä¸'ä¿æŠ¤è‡ªå·±", "å¦‚æœæœ‹å‹åšäº†è®©ä½ ä¸èˆ’æœçš„äº‹ï¼Œå¯ä»¥ç›´æ¥ä½†å‹å¥½åœ°å‘Šè¯‰ä»–ä½ çš„æ„Ÿå—", "æ¯ä¸ªäººéƒ½æœ‰ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œæœ‹å‹ä¹‹é—´è¦å­¦ä¼šäº’ç›¸åŒ…å®¹", "å‹è°Šéœ€è¦æ—¶é—´å’Œè€å¿ƒæ¥åŸ¹å…»ï¼Œä¸ç”¨æ€¥äºæ±‚æˆ", "çœŸæ­£çš„æœ‹å‹ä¼šåœ¨ä½ å›°éš¾æ—¶æ”¯æŒä½ ï¼Œè€Œä¸æ˜¯å˜²ç¬‘ä½ "], tips: "å¸®åŠ©å­©å­ç†è§£å‹è°Šçš„çœŸè°›ï¼Œæ•™ä»–ä»¬è®¾ç«‹å¥åº·çš„äººé™…è¾¹ç•Œï¼ŒåŒæ—¶åŸ¹å…»è§£å†³å†²çªçš„èƒ½åŠ›ã€‚" },
            school: { title: "å­¦æ ¡ç”Ÿæ´»", color: "#9980fa", prompts: ["ä»Šå¤©åœ¨å­¦æ ¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¼€å¿ƒæˆ–è€…æœ‰è¶£çš„äº‹æƒ…æƒ³åˆ†äº«å—ï¼Ÿ", "æˆ‘æ³¨æ„åˆ°ä½ æœ€è¿‘ä¸å¤ªæƒ³è°ˆè®ºå­¦æ ¡çš„äº‹æƒ…ï¼Œæ˜¯é‡åˆ°ä»€ä¹ˆå›°éš¾äº†å—ï¼Ÿ", "æœ‹å‹ä¹‹é—´æœ‰æ—¶ä¼šæœ‰çŸ›ç›¾ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œéœ€è¦æˆ‘å¸®ä½ æƒ³æƒ³æ€ä¹ˆè§£å†³å—ï¼Ÿ", "è€å¸ˆåé¦ˆè¯´ä½ åœ¨è¯¾å ‚ä¸Šå¾ˆç§¯æå‚ä¸ï¼Œæˆ‘ä¸ºä½ æ„Ÿåˆ°éª„å‚²ï¼", "æ–°å­¦æœŸå¼€å§‹å¯èƒ½ä¼šæœ‰äº›ä¸é€‚åº”ï¼Œè¿™å¾ˆæ­£å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ…¢æ…¢è°ƒæ•´", "å¦‚æœé‡åˆ°å­¦ä¹ ä¸Šçš„å›°éš¾ï¼Œé™¤äº†é—®æˆ‘ï¼Œä¹Ÿå¯ä»¥ä¸»åŠ¨å‘è€å¸ˆè¯·æ•™", "å‚åŠ è¯¾å¤–æ´»åŠ¨æ˜¯è®¤è¯†æ–°æœ‹å‹çš„å¥½æœºä¼šï¼Œä½ æœ‰å…´è¶£å°è¯•ä»€ä¹ˆæ´»åŠ¨å—ï¼Ÿ", "è€ƒè¯•åªæ˜¯æ£€éªŒå­¦ä¹ çš„æ–¹å¼ä¹‹ä¸€ï¼Œé‡è¦çš„æ˜¯ä½ çœŸæ­£æŒæ¡äº†çŸ¥è¯†", "æ¯ä¸ªè€å¸ˆæ•™å­¦é£æ ¼ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥è®¨è®ºå¦‚ä½•é€‚åº”ä¸åŒè€å¸ˆçš„æ•™å­¦æ–¹æ³•", "å­¦æ ¡ä¸åªæ˜¯å­¦ä¹ çŸ¥è¯†çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å­¦ä¹ å¦‚ä½•ä¸äººç›¸å¤„çš„åœ°æ–¹"], tips: "ä½¿ç”¨å¼€æ”¾å¼é—®é¢˜äº†è§£å­©å­çš„å­¦æ ¡ç”Ÿæ´»ï¼Œé¿å…ç®€å•çš„æ˜¯/å¦é—®é¢˜ã€‚å…³æ³¨å­©å­çš„ç¤¾äº¤å’Œæƒ…æ„Ÿå‘å±•ï¼Œè€Œä¸ä»…ä»…æ˜¯å­¦ä¸šè¡¨ç°ã€‚" }
        };
        
        // é¡µé¢å…ƒç´ 
        const homePage = document.getElementById('home-page');
        const chatPage = document.getElementById('chat-page');
        const sceneCards = document.querySelectorAll('.scene-card');
        const backBtn = document.getElementById('back-btn');
        const sceneColor = document.getElementById('scene-color');
        const chatSceneTitle = document.getElementById('chat-scene-title');
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const apiStatus = document.getElementById('api-status');
        
        let currentScene = null;
        let currentSceneColor = null;
        
        // æ”¯ä»˜ç›¸å…³å˜é‡
        let selectedPrice = 29.9;
        let selectedPeriod = 'month';
        let selectedPaymentMethod = 'wechat';
        
        // åˆå§‹åŒ–é¡µé¢æ˜¾ç¤ºçŠ¶æ€
        function initializePageDisplay() {
            homePage.style.display = 'flex';
            chatPage.style.display = 'none';
            
            const modals = document.querySelectorAll('[id$="Modal"]');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        // ä¿®å¤åœºæ™¯ç‚¹å‡»åŠŸèƒ½
        function initializeSceneCards() {
            sceneCards.forEach(card => {
                card.addEventListener('click', function() {
                    const sceneId = this.getAttribute('data-scene');
                    currentScene = sceneId;
                    currentSceneColor = expandedScriptLibrary[sceneId].color;
                    
                    sceneColor.style.backgroundColor = expandedScriptLibrary[sceneId].color;
                    chatSceneTitle.textContent = expandedScriptLibrary[sceneId].title;
                    
                    homePage.style.display = 'none';
                    chatPage.style.display = 'flex';
                    
                    const messages = chatContainer.querySelectorAll('.message');
                    messages.forEach((msg, index) => {
                        if (index > 0) msg.remove();
                    });
                    
                    addAIMessage(`å…³äº${expandedScriptLibrary[sceneId].title}ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨ï¼š<br>â€¢ æä¾›å…·ä½“æƒ…å¢ƒä¸‹çš„æ²Ÿé€šè¯æœ¯<br>â€¢ åˆ†æå­©å­è¡Œä¸ºèƒŒåçš„åŸå› <br>â€¢ å»ºè®®æœ‰æ•ˆçš„æ²Ÿé€šç­–ç•¥<br><br>${expandedScriptLibrary[sceneId].tips}`);
                });
            });
        }
        
        // è¿”å›æŒ‰é’®åŠŸèƒ½
        backBtn.addEventListener('click', function() {
            chatPage.style.display = 'none';
            homePage.style.display = 'flex';
        });
        
        // å‘é€æ¶ˆæ¯åŠŸèƒ½
        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;
            
            addUserMessage(text);
            messageInput.value = '';
            sendBtn.disabled = true;
            
            typingIndicator.style.display = 'block';
            
            try {
                let aiResponse;
                
                // æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°
                const isMember = checkMembershipStatus();
                if (!isMember) {
                    const today = new Date().toDateString();
                    const lastUsed = localStorage.getItem('lastUsedDate');
                    let dailyCount = parseInt(localStorage.getItem('dailyUsageCount') || '0');
                    
                    if (lastUsed !== today) {
                        dailyCount = 0;
                        localStorage.setItem('lastUsedDate', today);
                    }
                    
                    if (dailyCount >= 3) {
                        typingIndicator.style.display = 'none';
                        alert('ä»Šæ—¥å…è´¹æ¬¡æ•°å·²ç”¨å®Œï¼Œè¯·å‡çº§ä¼šå‘˜äº«å—æ— é™å¯¹è¯');
                        sendBtn.disabled = false;
                        return;
                    }
                    
                    dailyCount++;
                    localStorage.setItem('dailyUsageCount', dailyCount.toString());
                    updateUsageDisplay();
                }
                
                // è°ƒç”¨AI API
                aiResponse = await callDeepSeekAPI(text);
                
                typingIndicator.style.display = 'none';
                addAIMessage(aiResponse);
                
            } catch (error) {
                console.error("å‘é€æ¶ˆæ¯æ—¶å‡ºé”™:", error);
                typingIndicator.style.display = 'none';
                
                const localResponse = generateLocalResponse(text);
                addAIMessage("<small><em>æç¤ºï¼šAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œå·²åˆ‡æ¢åˆ°æœ¬åœ°å›å¤</em></small><br><br>" + localResponse);
            } finally {
                sendBtn.disabled = false;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        
        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user-message';
            messageDiv.textContent = text;
            messageDiv.style.background = currentSceneColor || '#4a69bd';
            chatContainer.appendChild(messageDiv);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // æ·»åŠ AIæ¶ˆæ¯
        function addAIMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            messageDiv.innerHTML = text;
            chatContainer.appendChild(messageDiv);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // ç”Ÿæˆæœ¬åœ°å›å¤
        function generateLocalResponse(userInput) {
            if (!currentScene) return "è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåœºæ™¯ã€‚";
            
            const prompts = expandedScriptLibrary[currentScene].prompts;
            const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
            
            let additionalTip = "";
            
            if (userInput.includes('ç”Ÿæ°”') || userInput.includes('æ„¤æ€’') || userInput.includes('å‘è„¾æ°”')) {
                additionalTip = "<br><br><strong>å°è´´å£«ï¼š</strong>å½“å­©å­æƒ…ç»ªæ¿€åŠ¨æ—¶ï¼Œå…ˆå¸®åŠ©ä»–å¹³é™ä¸‹æ¥ï¼Œå†è®¨è®ºé—®é¢˜æœ¬èº«ã€‚";
            } else if (userInput.includes('ä¸å¬è¯') || userInput.includes('åæŠ—') || userInput.includes('é¡¶å˜´')) {
                additionalTip = "<br><br><strong>å°è´´å£«ï¼š</strong>ç»™å­©å­æœ‰é™çš„é€‰æ‹©æƒï¼Œè€Œä¸æ˜¯ç®€å•å‘½ä»¤ï¼Œå¯ä»¥å‡å°‘æƒåŠ›æ–—äº‰ã€‚";
            } else if (userInput.includes('å­¦ä¹ ') || userInput.includes('æˆç»©') || userInput.includes('è€ƒè¯•')) {
                additionalTip = "<br><br><strong>å°è´´å£«ï¼š</strong>å…³æ³¨å­¦ä¹ è¿‡ç¨‹è€Œéç»“æœï¼Œå¸®åŠ©å­©å­å»ºç«‹æˆé•¿å‹æ€ç»´ã€‚";
            } else if (userInput.includes('æœ‹å‹') || userInput.includes('åŒå­¦') || userInput.includes('ç¤¾äº¤')) {
                additionalTip = "<br><br><strong>å°è´´å£«ï¼š</strong>æ•™å­©å­ç¤¾äº¤æŠ€å·§æ¯”ç›´æ¥ä»‹å…¥è§£å†³é—®é¢˜æ›´æœ‰æ•ˆã€‚";
            } else if (userInput.includes('æ‰‹æœº') || userInput.includes('å¹³æ¿') || userInput.includes('æ¸¸æˆ')) {
                additionalTip = "<br><br><strong>å°è´´å£«ï¼š</strong>ä¸å­©å­å…±åŒåˆ¶å®šå±å¹•æ—¶é—´è§„åˆ™ï¼Œæ¯”å•çº¯é™åˆ¶æ›´æœ‰æ•ˆã€‚";
            } else if (userInput.includes('è§„åˆ™') || userInput.includes('çºªå¾‹') || userInput.includes('ä¸å®ˆè§„çŸ©')) {
                additionalTip = "<br><br><strong>å°è´´å£«ï¼š</strong>è§£é‡Šè§„åˆ™èƒŒåçš„åŸå› ï¼Œè®©å­©å­ç†è§£è€Œä¸ä»…ä»…æ˜¯æœä»ã€‚";
            }
            
            return randomPrompt + additionalTip;
        }
        
        // ä¿®å¤çš„ API è°ƒç”¨å‡½æ•°
        async function callDeepSeekAPI(userInput) {
            try {
                console.log('è°ƒç”¨ DeepSeek API...');
                
                // è®¾ç½®è¶…æ—¶æ§åˆ¶
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);
                
                const response = await fetch('/api/deepseek', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: userInput,
                        scene: currentScene,
                        userType: checkMembershipStatus() ? 'premium' : 'free'
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`ç½‘ç»œå“åº”ä¸æ­£å¸¸: ${response.status}`);
                }

                const data = await response.json();
                console.log('API å“åº”:', data);
                
                if (data.success && data.reply) {
                    return data.reply;
                } else if (data.reply) {
                    return data.reply;
                } else {
                    throw new Error(data.error || 'æœªçŸ¥é”™è¯¯');
                }
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                if (error.name === 'AbortError') {
                    return 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚';
                }
                return generateLocalResponse(userInput);
            }
        }
        
        // ä¿®å¤ API çŠ¶æ€æ£€æŸ¥
        function checkAPIStatus() {
            try {
                apiStatus.textContent = "âœ… æœåŠ¡æ­£å¸¸ - ä½¿ç”¨å®‰å…¨APIè¿æ¥";
                apiStatus.style.color = "#27ae60";
                return true;
            } catch (error) {
                apiStatus.textContent = "âš ï¸ æœåŠ¡æ£€æŸ¥ä¸­...";
                apiStatus.style.color = "#f39c12";
                return true;
            }
        }
        
        // æ”¯ä»˜ç›¸å…³åŠŸèƒ½
        function showPaymentPage() {
            document.getElementById('paywallModal').style.display = 'none';
            document.getElementById('benefitsModal').style.display = 'none';
            document.getElementById('paymentModal').style.display = 'flex';
        }
        
        function showBenefitsPage() {
            document.getElementById('paywallModal').style.display = 'none';
            document.getElementById('benefitsModal').style.display = 'flex';
        }
        
        function closeBenefits() {
            document.getElementById('benefitsModal').style.display = 'none';
            document.getElementById('paywallModal').style.display = 'flex';
        }
        
        function closePayment() {
            document.getElementById('paymentModal').style.display = 'none';
            document.getElementById('paywallModal').style.display = 'flex';
        }
        
        function selectPriceOption(element, price, period) {
            document.querySelectorAll('.price-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedPrice = price;
            selectedPeriod = period;
            updatePayButton();
        }
        
        function selectPaymentMethod(element, method) {
            document.querySelectorAll('.payment-method').forEach(m => {
                m.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedPaymentMethod = method;
        }
        
        function updatePayButton() {
            const payButton = document.getElementById('payButton');
            const agreeCheckbox = document.getElementById('agreeCheckbox');
            
            payButton.textContent = `ç«‹å³æ”¯ä»˜ Â¥${selectedPrice}`;
            payButton.disabled = !agreeCheckbox.checked;
        }
        
        function showUserAgreement() {
            document.getElementById('agreementModal').style.display = 'flex';
        }
        
        function closeAgreement() {
            document.getElementById('agreementModal').style.display = 'none';
        }
        
        function showPrivacyPolicy() {
            document.getElementById('privacyModal').style.display = 'flex';
        }
        
        function closePrivacy() {
            document.getElementById('privacyModal').style.display = 'none';
        }
        
        async function processPayment() {
            const payButton = document.getElementById('payButton');
            const originalText = payButton.textContent;
            
            try {
                payButton.disabled = true;
                payButton.textContent = 'æ”¯ä»˜å¤„ç†ä¸­...';
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                localStorage.setItem('isPaidUser', 'true');
                localStorage.setItem('membershipExpire', getExpireDate(selectedPeriod));
                localStorage.setItem('membershipType', selectedPeriod);
                localStorage.setItem('purchaseDate', new Date().toISOString());
                
                updateUsageDisplay();
                
                alert('ğŸ‰ æ”¯ä»˜æˆåŠŸï¼æ¬¢è¿åŠ å…¥ä¼šå‘˜ï¼');
                
                closePayment();
                closePaywall();
                
            } catch (error) {
                console.error('æ”¯ä»˜å¤±è´¥:', error);
                alert('æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–è”ç³»å®¢æœ');
            } finally {
                payButton.disabled = false;
                payButton.textContent = originalText;
            }
        }
        
        function getExpireDate(period) {
            const now = new Date();
            if (period === 'month') {
                now.setMonth(now.getMonth() + 1);
            } else if (period === 'year') {
                now.setFullYear(now.getFullYear() + 1);
            }
            return now.toISOString();
        }
        
        function checkMembershipStatus() {
            const isPaid = localStorage.getItem('isPaidUser') === 'true';
            const expireDate = localStorage.getItem('membershipExpire');
            
            if (isPaid && expireDate) {
                const now = new Date();
                const expire = new Date(expireDate);
                if (now > expire) {
                    localStorage.setItem('isPaidUser', 'false');
                    return false;
                }
                return true;
            }
            return false;
        }
        
        function updateUsageDisplay() {
            const usageCountElement = document.getElementById('usage-count');
            const memberStatusElement = document.getElementById('member-status');
            const statusTextElement = document.getElementById('status-text');
            
            const isMember = checkMembershipStatus();
            
            if (isMember) {
                if (usageCountElement) usageCountElement.style.display = 'none';
                if (memberStatusElement) memberStatusElement.style.display = 'inline';
                if (statusTextElement) statusTextElement.textContent = 'ä¼šå‘˜æœåŠ¡æ­£å¸¸';
            } else {
                if (usageCountElement) usageCountElement.style.display = 'inline';
                if (memberStatusElement) memberStatusElement.style.display = 'none';
                if (statusTextElement) statusTextElement.textContent = 'å…è´¹æœåŠ¡æ­£å¸¸';
                
                const freeUsage = document.getElementById('free-usage');
                if (freeUsage) {
                    const today = new Date().toDateString();
                    const lastUsed = localStorage.getItem('lastUsedDate');
                    let dailyCount = parseInt(localStorage.getItem('dailyUsageCount') || '0');
                    
                    if (lastUsed !== today) {
                        dailyCount = 0;
                        localStorage.setItem('lastUsedDate', today);
                    }
                    
                    const remaining = Math.max(0, 3 - dailyCount);
                    freeUsage.textContent = remaining;
                    
                    if (remaining === 0) {
                        statusTextElement.textContent = 'ä»Šæ—¥å…è´¹æ¬¡æ•°å·²ç”¨å®Œ';
                        statusTextElement.style.color = '#e74c3c';
                    }
                }
            }
        }

        function openPremiumModal() {
            document.getElementById('paywallModal').style.display = 'flex';
        }
        
        function closePaywall() {
            document.getElementById('paywallModal').style.display = 'none';
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePageDisplay();
            initializeSceneCards();
            
            sendBtn.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            const agreeCheckbox = document.getElementById('agreeCheckbox');
            if (agreeCheckbox) {
                agreeCheckbox.addEventListener('change', updatePayButton);
            }
            
            updateUsageDisplay();
            checkAPIStatus();
        });
    </script>

    <script>
        // PWA Service Worker æ³¨å†Œ
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker æ³¨å†Œå¤±è´¥: ', error);
                    });
            });
        }

        // PWA å®‰è£…æç¤º
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('å¯ä»¥å®‰è£…ä¸º PWA åº”ç”¨');
        });
    </script>
        <!-- åœ¨è¿™é‡Œæ·»åŠ Service Workeræ³¨å†Œä»£ç  -->
    <script>
        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker æ³¨å†ŒæˆåŠŸï¼Œä½œç”¨åŸŸ: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Service Worker æ³¨å†Œå¤±è´¥: ', error);
                    });
            });
        }
    </script>
</body>
</html>

